<?xml version="1.0" encoding="UTF-8"?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="atomex.CurrencyPage"
             xmlns:controls="clr-namespace:atomex.CustomElements"
             xmlns:ffimageloadingsvg="clr-namespace:FFImageLoading.Svg.Forms;assembly=FFImageLoading.Svg.Forms"
             xmlns:resources="clr-namespace:atomex.Resources"
             Title="{Binding Currency.Description}"
             BackgroundColor="{DynamicResource MainBackgroundColor}">
    <StackLayout Spacing="0">
        <SwipeView BackgroundColor="{DynamicResource MainBackgroundColor}">
            <SwipeView.TopItems>
                <SwipeItems Mode="Execute">
                    <SwipeItem Invoked="SwipeDown"/>
                </SwipeItems>
            </SwipeView.TopItems>
            <StackLayout BackgroundColor="{DynamicResource MainBackgroundColor}"
                         Spacing="0">
                <Label x:Name="LoaderLabel"
                       Text="{x:Static resources:AppResources.BalanceUpdatingLabel}"
                       TextColor="{DynamicResource HintTextColor}"
                       FontFamily="{DynamicResource ItalicFont}"
                       HorizontalTextAlignment="Center"
                       VerticalTextAlignment="Center"
                       IsVisible="False"
                       Margin="0,20,0,10"/>
                <ActivityIndicator x:Name="Loader"
                                   Color="{DynamicResource HintTextColor}"
                                   IsVisible="False"/>
                <ffimageloadingsvg:SvgCachedImage WidthRequest="96"
                                                  HeightRequest="96"
                                                  Margin="20"
                                                  Source="{Binding CurrencyCode, StringFormat='{0}.svg'}"/>
                <Label Text="{Binding AvailableAmount}"
                       x:Name="AvailableAmountLabel"
                       HorizontalOptions="Center">
                    <Label.FormattedText>
                        <FormattedString>
                            <Span Text="{Binding AvailableAmount}"
                                  FontSize="20"
                                  FontFamily="{DynamicResource BoldFont}"/>
                            <Span Text=" " /> 
                            <Span Text="{Binding CurrencyCode}"
                                  FontSize="16"
                                  FontFamily="{DynamicResource BoldFont}"/>
                        </FormattedString>
                    </Label.FormattedText>
                </Label>
                <Label x:Name="AvailableAmountInBaseLabel"
                       FontFamily="{DynamicResource RegularFont}"
                       FontSize="14"
                       TextColor="{DynamicResource AdditionalTextColor}"
                       VerticalTextAlignment="Start"
                       HorizontalOptions="Center">
                    <Label.FormattedText>
                        <FormattedString>
                            <Span Text="{Binding Cost, StringFormat='{0:0.##}'}"/>
                            <Span Text=" $"/>
                        </FormattedString>
                    </Label.FormattedText>
                </Label>
                <StackLayout Orientation="Horizontal"
                             HorizontalOptions="Center"
                             HeightRequest="40"
                             Margin="10,20"
                             Spacing="0">
                    <controls:LeftRoundedButton Text="{x:Static resources:AppResources.SendButton}"
                                                Style="{DynamicResource CurrencyActionButtonStyle}"
                                                Clicked="ShowSendPage"/>
                    <Button Text="{x:Static resources:AppResources.ReceiveButton}"
                            Style="{DynamicResource CurrencyActionButtonStyle}"
                            Clicked="ShowReceivePage"/>
                    <Button Text="{x:Static resources:AppResources.DelegateButton}"
                            x:Name="DelegateButton"
                            IsVisible="false"
                            Style="{DynamicResource CurrencyActionButtonStyle}"
                            Clicked="ShowDelegationPage"/>
                    <controls:RightRoundedButton Text="{x:Static resources:AppResources.ConvertButton}"
                                                 Style="{DynamicResource CurrencyActionButtonStyle}"
                                                 Clicked="ShowConversionPage"/>
                </StackLayout>
            </StackLayout>
        </SwipeView>
        <ListView ItemsSource="{Binding GroupedTransactions}"
                  BackgroundColor="{DynamicResource MainBackgroundColor}"
                  IsGroupingEnabled="True"
                  ItemTapped="OnListViewItemTapped"
                  HasUnevenRows="True"
                  SeparatorVisibility="None"
                  Footer="">
            <ListView.Triggers>
                <DataTrigger TargetType="ListView"
                             Binding="{Binding GroupedTransactions.Count}"
                             Value="0">
                    <Setter Property="IsVisible"
                            Value="False"/>
                </DataTrigger>
            </ListView.Triggers>
            <ListView.GroupHeaderTemplate>
                <DataTemplate>
                    <ViewCell Height="20">
                        <Label Text="{Binding Date, StringFormat='{}{0:dd.MM.yyyy}'}"
                               BackgroundColor="{DynamicResource AdditionalBackgroundColor}"
                               TextColor="{DynamicResource AdditionalTextColor}"
                               Padding="10,0"
                               FontSize="12"
                               VerticalTextAlignment="Center"
                               VerticalOptions="CenterAndExpand"
                               />
                     </ViewCell>
                </DataTemplate>
            </ListView.GroupHeaderTemplate>
            <ListView.ItemTemplate>
                <DataTemplate>
                    <ViewCell Height="60">
                        <Grid RowSpacing="0"
                              ColumnSpacing="0"
                              VerticalOptions="Center"
                              Margin="10">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="20" />
                                <RowDefinition Height="20" />
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="1.5*" />
                                <ColumnDefinition Width="5*" />
                                <ColumnDefinition Width="3.5*" />
                            </Grid.ColumnDefinitions>
                            <ffimageloadingsvg:SvgCachedImage Grid.RowSpan="2"
                                                              Margin="4">
                                <ffimageloadingsvg:SvgCachedImage.Triggers>
                                    <DataTrigger TargetType="ffimageloadingsvg:SvgCachedImage"
                                                 Binding="{Binding Type}"
                                                 Value="Input">
                                        <Setter Property="Source"
                                                Value="Down-arrow.svg"/>
                                    </DataTrigger>
                                    <DataTrigger TargetType="ffimageloadingsvg:SvgCachedImage"
                                                 Binding="{Binding Type}"
                                                 Value="Output">
                                        <Setter Property="Source"
                                                Value="Up-arrow.svg"/>
                                    </DataTrigger>
                                    <DataTrigger TargetType="ffimageloadingsvg:SvgCachedImage"
                                                 Binding="{Binding Type}"
                                                 Value="SwapPayment">
                                        <Setter Property="Source"
                                                Value="Right-arrow.svg"/>
                                    </DataTrigger>
                                    <DataTrigger TargetType="ffimageloadingsvg:SvgCachedImage"
                                                 Binding="{Binding Type}"
                                                 Value="SwapRedeem">
                                        <Setter Property="Source"
                                                Value="Spin-arrow.svg"/>
                                    </DataTrigger>
                                    <DataTrigger TargetType="ffimageloadingsvg:SvgCachedImage"
                                                 Binding="{Binding Type}"
                                                 Value="SwapRefund">
                                        <Setter Property="Source"
                                                Value="Refresh-arrow.svg"/>
                                    </DataTrigger>
                                </ffimageloadingsvg:SvgCachedImage.Triggers>
                            </ffimageloadingsvg:SvgCachedImage>
                            <Label Grid.Column="1"
                                   FontFamily="{DynamicResource RegularFont}"
                                   VerticalOptions="EndAndExpand">
                                <Label.Triggers>
                                    <DataTrigger TargetType="Label"
                                                 Binding="{Binding Type}"
                                                 Value="Output">
                                        <Setter Property="Text"
                                                Value="Sent"/>
                                    </DataTrigger>
                                    <DataTrigger TargetType="Label"
                                                 Binding="{Binding Type}"
                                                 Value="Input">
                                        <Setter Property="Text"
                                                Value="Received"/>
                                    </DataTrigger>
                                    <DataTrigger TargetType="Label"
                                                 Binding="{Binding Type}"
                                                 Value="SwapPayment">
                                        <Setter Property="Text"
                                                Value="Swap payment"/>
                                    </DataTrigger>
                                    <DataTrigger TargetType="Label"
                                                 Binding="{Binding Type}"
                                                 Value="SwapRedeem">
                                        <Setter Property="Text"
                                                Value="Swap redeem"/>
                                    </DataTrigger>
                                    <DataTrigger TargetType="Label"
                                                 Binding="{Binding Type}"
                                                 Value="SwapRefund">
                                        <Setter Property="Text"
                                                Value="Swap refund"/>
                                    </DataTrigger>
                                </Label.Triggers>
                            </Label>
                            <Label Grid.Column="2"
                                   Grid.RowSpan="2"
                                   HorizontalOptions="End"
                                   VerticalOptions="Center"
                                   VerticalTextAlignment="Center">
                                <Label.Triggers>
                                    <DataTrigger TargetType="Label"
                                                 Binding="{Binding Type}"
                                                 Value="Input">
                                        <Setter Property="TextColor"
                                                Value="Green"/>
                                        <Setter Property="FormattedText">
                                            <Setter.Value>
                                                <FormattedString>
                                                    <Span Text="{Binding Amount, StringFormat='+{0:0.#####}'}"
                                                          FontFamily="{DynamicResource RegularFont}"
                                                          FontSize="16"/>
                                                    <Span Text=" "/>
                                                    <Span Text="{Binding Currency.Name}"
                                                          FontFamily="{DynamicResource RegularFont}"
                                                          FontSize="12"/>
                                                </FormattedString>
                                            </Setter.Value>
                                        </Setter>
                                    </DataTrigger>
                                    <DataTrigger TargetType="Label"
                                                 Binding="{Binding Type}"
                                                 Value="Output">
                                        <Setter Property="TextColor"
                                                Value="Red"/>
                                        <Setter Property="FormattedText">
                                            <Setter.Value>
                                                <FormattedString>
                                                    <Span Text="{Binding Amount, StringFormat='{0:0.#####}'}"
                                                          FontFamily="{DynamicResource RegularFont}"
                                                          FontSize="16"/>
                                                    <Span Text=" "/>
                                                    <Span Text="{Binding Currency.Name}"
                                                          FontFamily="{DynamicResource RegularFont}"
                                                          FontSize="12"/>
                                                </FormattedString>
                                            </Setter.Value>
                                        </Setter>
                                    </DataTrigger>
                                    <DataTrigger TargetType="Label"
                                                 Binding="{Binding Type}"
                                                 Value="SwapPayment">
                                        <Setter Property="TextColor"
                                                Value="Red"/>
                                        <Setter Property="FormattedText">
                                            <Setter.Value>
                                                <FormattedString>
                                                    <Span Text="{Binding Amount, StringFormat='{0:0.#####}'}"
                                                          FontFamily="{DynamicResource RegularFont}"
                                                          FontSize="16"/>
                                                    <Span Text=" "/>
                                                    <Span Text="{Binding Currency.Name}"
                                                          FontFamily="{DynamicResource RegularFont}"
                                                          FontSize="12"/>
                                                </FormattedString>
                                            </Setter.Value>
                                        </Setter>
                                    </DataTrigger>
                                    <DataTrigger TargetType="Label"
                                                 Binding="{Binding Type}"
                                                 Value="SwapRedeem">
                                        <Setter Property="TextColor"
                                                Value="Green"/>
                                        <Setter Property="FormattedText">
                                            <Setter.Value>
                                                <FormattedString>
                                                    <Span Text="{Binding Amount, StringFormat='+{0:0.#####}'}"
                                                          FontFamily="{DynamicResource RegularFont}"
                                                          FontSize="16"/>
                                                    <Span Text=" "/>
                                                    <Span Text="{Binding Currency.Name}"
                                                          FontFamily="{DynamicResource RegularFont}"
                                                          FontSize="12"/>
                                                </FormattedString>
                                            </Setter.Value>
                                        </Setter>
                                    </DataTrigger>
                                    <DataTrigger TargetType="Label"
                                                 Binding="{Binding Type}"
                                                 Value="SwapRefund">
                                        <Setter Property="TextColor"
                                                Value="Green"/>
                                        <Setter Property="FormattedText">
                                            <Setter.Value>
                                                <FormattedString>
                                                    <Span Text="{Binding Amount, StringFormat='+{0:0.#####}'}"
                                                          FontFamily="{DynamicResource RegularFont}"
                                                          FontSize="16"/>
                                                    <Span Text=" "/>
                                                    <Span Text="{Binding Currency.Name}"
                                                          FontFamily="{DynamicResource RegularFont}"
                                                          FontSize="12"/>
                                                </FormattedString>
                                            </Setter.Value>
                                        </Setter>
                                    </DataTrigger>
                                </Label.Triggers>
                            </Label>
                            <Label Grid.Row="1"
                                   Grid.Column="1"
                                   VerticalOptions="StartAndExpand"
                                   FontFamily="{DynamicResource LightFont}"
                                   TextColor="Gray"
                                   FontSize="12"
                                   LineBreakMode="MiddleTruncation">
                                <Label.Triggers>             
                                    <DataTrigger TargetType="Label"
                                                 Binding="{Binding Type}"
                                                 Value="Output">
                                        <Setter Property="FormattedText">
                                            <Setter.Value>
                                                <FormattedString>
                                                    <Span Text="To: "/>
                                                    <Span Text="{Binding To, FallbackValue='Unknown'}"/>
                                                </FormattedString>
                                            </Setter.Value>
                                        </Setter>
                                    </DataTrigger>
                                    <DataTrigger TargetType="Label"
                                                 Binding="{Binding Type}"
                                                 Value="Input">
                                        <Setter Property="FormattedText">
                                            <Setter.Value>
                                                <FormattedString>
                                                    <Span Text="From: "/>
                                                    <Span Text="{Binding From, FallbackValue='Unknown'}"/>
                                                </FormattedString>
                                            </Setter.Value>
                                        </Setter>
                                    </DataTrigger>
                                    <DataTrigger TargetType="Label"
                                                 Binding="{Binding Type}"
                                                 Value="SwapPayment">
                                        <Setter Property="FormattedText">
                                            <Setter.Value>
                                                <FormattedString>
                                                    <Span Text="To: "/>
                                                    <Span Text="{Binding To, FallbackValue='Unknown'}"/>
                                                </FormattedString>
                                            </Setter.Value>
                                        </Setter>
                                    </DataTrigger>
                                    <DataTrigger TargetType="Label"
                                                 Binding="{Binding Type}"
                                                 Value="SwapRedeem">
                                        <Setter Property="FormattedText">
                                            <Setter.Value>
                                                <FormattedString>
                                                    <Span Text="From: "/>
                                                    <Span Text="{Binding From, FallbackValue='Unknown'}"/>
                                                </FormattedString>
                                            </Setter.Value>
                                        </Setter>
                                    </DataTrigger>
                                    <DataTrigger TargetType="Label"
                                                 Binding="{Binding Type}"
                                                 Value="SwapRefund">
                                        <Setter Property="FormattedText">
                                            <Setter.Value>
                                                <FormattedString>
                                                    <Span Text="From: "/>
                                                    <Span Text="{Binding From, FallbackValue='Unknown'}"/>
                                                </FormattedString>
                                            </Setter.Value>
                                        </Setter>
                                    </DataTrigger>
                                </Label.Triggers>
                            </Label>
                        </Grid>
                    </ViewCell>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>
    </StackLayout>
</ContentPage>