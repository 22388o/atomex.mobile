<?xml version="1.0" encoding="UTF-8"?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="atomex.CurrencyPage"
             Title="{Binding Currency.Description}">
    <StackLayout>
        <SwipeView>
            <SwipeView.TopItems>
                <SwipeItems Mode="Execute">
                    <SwipeItem Invoked="SwipeDown"/>
                </SwipeItems>
            </SwipeView.TopItems>
            <StackLayout>
                <Label x:Name="LoaderLabel"
                       Text="Balance updating..."
                       TextColor="CadetBlue"
                       HorizontalTextAlignment="Center"
                       VerticalTextAlignment="Center"
                       FontAttributes="Italic"
                       IsVisible="False"
                       Margin="0,20,0,10"/>
                <ActivityIndicator x:Name="Loader"
                                   Color="CadetBlue"
                                   IsVisible="False"/>
                <Image Source="{Binding CurrencyCode}"
                       HeightRequest="64"
                       WidthRequest="64"
                       Margin="0,30,0,10" />
                <Label Text="{Binding AvailableAmount}"
                       x:Name="AvailableAmountLabel"
                       HorizontalOptions="Center"
                       FontSize="Large"
                       FontAttributes="Bold">
                    <Label.FormattedText>
                        <FormattedString>
                            <Span Text="{Binding AvailableAmount}" />
                            <Span Text=" " /> 
                            <Span Text="{Binding CurrencyCode}" />
                        </FormattedString>
                    </Label.FormattedText>
                </Label>
                <Label Text="{Binding Currency.Description}"
                       HorizontalOptions="Center"/>
                <StackLayout Orientation="Horizontal"
                             HorizontalOptions="CenterAndExpand"
                             Margin="10,20">
                    <StackLayout>
                        <ImageButton Source="SendIcon"
                                     Margin="10"
                                     HeightRequest="40"
                                     WidthRequest="40"
                                     HorizontalOptions="CenterAndExpand"
                                     VerticalOptions="CenterAndExpand"
                                     Clicked="ShowSendPage"/>
                        <Label Text="Send"
                               FontAttributes="Bold"
                               HorizontalOptions="CenterAndExpand"
                               VerticalOptions="CenterAndExpand" />
                    </StackLayout>
                    <StackLayout>
                        <ImageButton Source="ReceiveIcon"
                                     Margin="10"
                                     HeightRequest="40"
                                     WidthRequest="40"
                                     HorizontalOptions="CenterAndExpand"
                                     VerticalOptions="CenterAndExpand"
                                     Clicked="ShowReceivePage"/>
                        <Label Text="Receive"
                               FontAttributes="Bold"
                               HorizontalOptions="Center"
                               VerticalOptions="CenterAndExpand" />
                    </StackLayout>
                    <StackLayout>
                        <ImageButton Source="ConversionIcon"
                                     Margin="10"
                                     HeightRequest="40"
                                     WidthRequest="40"
                                     HorizontalOptions="CenterAndExpand"
                                     VerticalOptions="CenterAndExpand"
                                     Clicked="ShowConversionPage"/>
                        <Label Text="Convert"
                               FontAttributes="Bold"
                               HorizontalOptions="Center"
                               VerticalOptions="CenterAndExpand" />
                    </StackLayout>
                    <StackLayout x:Name="DelegateOption"
                                 IsVisible="false">
                        <ImageButton Source="DelegateIcon"
                                     Margin="10"
                                     HeightRequest="40"
                                     WidthRequest="40"
                                     HorizontalOptions="CenterAndExpand"
                                     VerticalOptions="CenterAndExpand"
                                     Clicked="ShowDelegationPage"/>
                        <Label Text="Delegate"
                               FontAttributes="Bold"
                               HorizontalOptions="Center"
                               VerticalOptions="CenterAndExpand"/>
                    </StackLayout>
                </StackLayout>
            </StackLayout>
        </SwipeView>
        <ListView ItemsSource="{Binding Transactions}"
                  ItemTapped="OnListViewItemTapped"
                  HasUnevenRows="True"
                  SeparatorVisibility="None"
                  Footer="">
            <ListView.Triggers>
                <DataTrigger TargetType="ListView"
                             Binding="{Binding Transactions.Count}"
                             Value="0">
                    <Setter Property="IsVisible"
                            Value="False"></Setter>
                </DataTrigger>
            </ListView.Triggers>
            <ListView.ItemTemplate>
                <DataTemplate>
                    <ViewCell>
                        <Frame HasShadow="False"
                               BackgroundColor="#dae4e5"
                               Padding="0"
                               Margin="10,2">
                            <Grid Padding="10"
                                  RowSpacing="0"
                                  ColumnSpacing="0">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="20" />
                                    <RowDefinition Height="20" />
                                    <RowDefinition Height="20" />
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="1.5*" />
                                    <ColumnDefinition Width="5*" />
                                    <ColumnDefinition Width="3.5*" />
                                </Grid.ColumnDefinitions>
                                <Label Grid.ColumnSpan="3"
                                       Text="{Binding LocalTime, StringFormat='{}{0:dd.MM.yyyy HH:mm}'}"
                                       Margin="10,0"
                                       FontAttributes="Bold"
                                       FontSize="12"
                                       TextColor="Gray"
                                       VerticalTextAlignment="Start"/>
                                <Image Grid.Row="1"
                                       Grid.RowSpan="2"
                                       Source="SendIcon"
                                       Margin="10,0">
                                    <Image.Triggers>
                                        <DataTrigger TargetType="Image"
                                                     Binding="{Binding Type}"
                                                     Value="Input">
                                            <Setter Property="Source"
                                                    Value="ReceiveIcon"/>
                                        </DataTrigger>
                                        <DataTrigger TargetType="Image"
                                                     Binding="{Binding Type}"
                                                     Value="Output">
                                            <Setter Property="Source"
                                                    Value="SendIcon"/>
                                        </DataTrigger>
                                        <DataTrigger TargetType="Image"
                                                     Binding="{Binding Type}"
                                                     Value="Self">
                                            <Setter Property="Source"
                                                    Value="CircleIcon"/>
                                        </DataTrigger>
                                        <DataTrigger TargetType="Image"
                                                     Binding="{Binding Type}"
                                                     Value="SwapPayment">
                                            <Setter Property="Source"
                                                    Value="ConversionIcon"/>
                                        </DataTrigger>
                                        <DataTrigger TargetType="Image"
                                                     Binding="{Binding Type}"
                                                     Value="SwapRedeem">
                                            <Setter Property="Source"
                                                    Value="ConversionIcon"/>
                                        </DataTrigger>
                                        <DataTrigger TargetType="Image"
                                                     Binding="{Binding Type}"
                                                     Value="SwapRefund">
                                            <Setter Property="Source"
                                                    Value="ConversionIcon"/>
                                        </DataTrigger>
                                    </Image.Triggers>
                                </Image>
                                <Label Grid.Row="1"
                                       Grid.Column="1"
                                       FontAttributes="Bold"
                                       VerticalOptions="EndAndExpand">
                                    <Label.Triggers>
                                        <DataTrigger TargetType="Label"
                                                     Binding="{Binding Type}"
                                                     Value="Output">
                                            <Setter Property="Text"
                                                    Value="Sent"/>
                                        </DataTrigger>
                                        <DataTrigger TargetType="Label"
                                                     Binding="{Binding Type}"
                                                     Value="Input">
                                            <Setter Property="Text"
                                                    Value="Received"/>
                                        </DataTrigger>
                                        <DataTrigger TargetType="Label"
                                                     Binding="{Binding Type}"
                                                     Value="Self">
                                            <Setter Property="Text"
                                                    Value="Transaction to yourself"/>
                                        </DataTrigger>
                                        <DataTrigger TargetType="Label"
                                                     Binding="{Binding Type}"
                                                     Value="SwapPayment">
                                            <Setter Property="Text"
                                                    Value="Swap"/>
                                        </DataTrigger>
                                        <DataTrigger TargetType="Label"
                                                     Binding="{Binding Type}"
                                                     Value="SwapRedeem">
                                            <Setter Property="Text"
                                                    Value="Swap"/>
                                        </DataTrigger>
                                        <DataTrigger TargetType="Label"
                                                     Binding="{Binding Type}"
                                                     Value="SwapRefund">
                                            <Setter Property="Text"
                                                    Value="Swap"/>
                                        </DataTrigger>
                                    </Label.Triggers>
                                </Label>
                                <Label Grid.Row="1"
                                       Grid.Column="2"
                                       Grid.RowSpan="2"
                                       Text="{Binding Amount, StringFormat='{0}'}"
                                       FontAttributes="Bold"
                                       HorizontalOptions="End"
                                       VerticalOptions="Center">
                                    <Label.Triggers>
                                        <DataTrigger TargetType="Label"
                                                     Binding="{Binding Type}"
                                                     Value="Input">
                                            <Setter Property="TextColor"
                                                    Value="Green"/>
                                            <Setter Property="FormattedText">
                                                <Setter.Value>
                                                    <FormattedString>
                                                        <Span Text="{Binding Amount, StringFormat='+{0:0.#####}'}"/>
                                                        <Span Text=" "/>
                                                        <Span Text="{Binding Currency.Name}"/>
                                                    </FormattedString>
                                                </Setter.Value>
                                            </Setter>
                                        </DataTrigger>
                                        <DataTrigger TargetType="Label"
                                                     Binding="{Binding Type}"
                                                     Value="Output">
                                            <Setter Property="TextColor"
                                                    Value="Red"/>
                                            <Setter Property="FormattedText">
                                                <Setter.Value>
                                                    <FormattedString>
                                                        <Span Text="{Binding Amount, StringFormat='{0:0.#####}'}"/>
                                                        <Span Text=" "/>
                                                        <Span Text="{Binding Currency.Name}"/>
                                                    </FormattedString>
                                                </Setter.Value>
                                            </Setter>
                                        </DataTrigger>
                                        <DataTrigger TargetType="Label"
                                                     Binding="{Binding Type}"
                                                     Value="Self">
                                            <Setter Property="TextColor"
                                                    Value="Red"/>
                                            <Setter Property="FormattedText">
                                                <Setter.Value>
                                                    <FormattedString>
                                                        <Span Text="{Binding Amount, StringFormat='{0:0.#####}'}"/>
                                                        <Span Text=" "/>
                                                        <Span Text="{Binding Currency.Name}"/>
                                                    </FormattedString>
                                                </Setter.Value>
                                            </Setter>
                                        </DataTrigger>
                                        <DataTrigger TargetType="Label"
                                                     Binding="{Binding Type}"
                                                     Value="SwapPayment">
                                            <Setter Property="FormattedText">
                                                <Setter.Value>
                                                    <FormattedString>
                                                        <Span Text="{Binding Amount, StringFormat='{0:0.#####}'}"/>
                                                        <Span Text=" "/>
                                                        <Span Text="{Binding Currency.Name}"/>
                                                    </FormattedString>
                                                </Setter.Value>
                                            </Setter>
                                        </DataTrigger>
                                        <DataTrigger TargetType="Label"
                                                     Binding="{Binding Type}"
                                                     Value="SwapRedeem">
                                            <Setter Property="FormattedText">
                                                <Setter.Value>
                                                    <FormattedString>
                                                        <Span Text="{Binding Amount, StringFormat='{0:0.#####}'}"/>
                                                        <Span Text=" "/>
                                                        <Span Text="{Binding Currency.Name}"/>
                                                    </FormattedString>
                                                </Setter.Value>
                                            </Setter>
                                        </DataTrigger>
                                        <DataTrigger TargetType="Label"
                                                     Binding="{Binding Type}"
                                                     Value="SwapRefund">
                                            <Setter Property="FormattedText">
                                                <Setter.Value>
                                                    <FormattedString>
                                                        <Span Text="{Binding Amount, StringFormat='{0:0.#####}'}"/>
                                                        <Span Text=" "/>
                                                        <Span Text="{Binding Currency.Name}"/>
                                                    </FormattedString>
                                                </Setter.Value>
                                            </Setter>
                                        </DataTrigger>
                                    </Label.Triggers>
                                </Label>
                                <Label Grid.Row="2"
                                       Grid.Column="1"
                                       VerticalOptions="StartAndExpand"
                                       TextColor="Gray"
                                       FontSize="12"
                                       LineBreakMode="MiddleTruncation">
                                    <Label.Triggers>             
                                        <DataTrigger TargetType="Label"
                                                     Binding="{Binding Type}"
                                                     Value="Output">
                                            <Setter Property="FormattedText">
                                                <Setter.Value>
                                                    <FormattedString>
                                                        <Span Text="To: "/>
                                                        <Span Text="{Binding To, FallbackValue='Unknown'}"/>
                                                    </FormattedString>
                                                </Setter.Value>
                                            </Setter>
                                        </DataTrigger>
                                        <DataTrigger TargetType="Label"
                                                     Binding="{Binding Type}"
                                                     Value="Input">
                                            <Setter Property="FormattedText">
                                                <Setter.Value>
                                                    <FormattedString>
                                                        <Span Text="From: "/>
                                                        <Span Text="{Binding From, FallbackValue='Unknown'}"/>
                                                    </FormattedString>
                                                </Setter.Value>
                                            </Setter>
                                        </DataTrigger>
                                        <DataTrigger TargetType="Label"
                                                     Binding="{Binding Type}"
                                                     Value="Self">
                                            <Setter Property="FormattedText">
                                                <Setter.Value>
                                                    <FormattedString>
                                                        <Span Text="Address: "/>
                                                        <Span Text="{Binding To, FallbackValue='Unknown'}"/>
                                                    </FormattedString>
                                                </Setter.Value>
                                            </Setter>
                                        </DataTrigger>
                                        <DataTrigger TargetType="Label"
                                                     Binding="{Binding Type}"
                                                     Value="SwapPayment">
                                            <Setter Property="FormattedText">
                                                <Setter.Value>
                                                    <FormattedString>
                                                        <Span Text="{Binding Description, FallbackValue='Unknown'}"/>
                                                    </FormattedString>
                                                </Setter.Value>
                                            </Setter>
                                        </DataTrigger>
                                        <DataTrigger TargetType="Label"
                                                     Binding="{Binding Type}"
                                                     Value="SwapRedeem">
                                            <Setter Property="FormattedText">
                                                <Setter.Value>
                                                    <FormattedString>
                                                        <Span Text="{Binding Description, FallbackValue='Unknown'}"/>
                                                    </FormattedString>
                                                </Setter.Value>
                                            </Setter>
                                        </DataTrigger>
                                        <DataTrigger TargetType="Label"
                                                     Binding="{Binding Type}"
                                                     Value="SwapRefund">
                                            <Setter Property="FormattedText">
                                                <Setter.Value>
                                                    <FormattedString>
                                                        <Span Text="{Binding Description, FallbackValue='Unknown'}"/>
                                                    </FormattedString>
                                                </Setter.Value>
                                            </Setter>
                                        </DataTrigger>
                                    </Label.Triggers>
                                </Label>
                            </Grid>
                        </Frame>
                    </ViewCell>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView> 
    </StackLayout>
</ContentPage>